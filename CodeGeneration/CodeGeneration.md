# Code Generation

## Introduction
Code generation is always a tricky way of producing code, as the code is generated by a tool (seen as a black-box, behaviour not modifiable) from a model and the obtained code slightly differs from what could have been obtained manually. 
Some rules have to be considered to avoid desesparation while trying to get expected code:
* __a specific code generator is required for each target platform__ . Hence thinking that a single code generator would do the job for all your projects will generate massive frustration when linking obtained code with third party code.
* __know your code generator capabilities__ , define properly your software interface and how data/functions are implemented (full force implementation or basic machine) 


## Glossary

*Component* : a component is at least made of a specification (MACHINE) and a refinement (IMPLEMENTATION). When the transformation from the specification to the implementation generates too many proof obligations, one or several intermediate refinements might be needed (MACHINE -> REFINEMENT -> ... -> IMPLEMENTATION).

*Machine*: abstract machine that describes services (OPERATIONS) provided by a component. OPERATIONS signature have to be the same (name, returned values, input parameters name, type and order) among specification, refinement and implementation.

*Refinement*: a model that is less abstract (more concrete) than the component specification.

*Implementation*: final refinement of a MACHINE. An implementation makes only use of B0 language. 

*Basic machine*: Compenent that is specified in B but implemented manually. The specification component is only used to generate a skeleton that needs to be completed by manual/third-party code. 

*B0*:				subset of the B language that is directly implementable: sequence, if-then-else, loop, operation call, scalar type, tables. This subset depends on the code generator.

*B0 checker*:		tool to verify that an implementation complies with B0 constraints, that it is effectively implementable

## Generating C source code

Generating C source code requires a software development project. You should choose this option when you create your project. It is not possible to change the nature of a project after its creation. 


![Example of a project status](images/status.jpg)

Code can be generated in two modes:
* component mode: you select a component in the component view, you right-click then select "code generator". The dialog below shows up. After having selected the proper translation profile, click OK. Unless you got error messages, the code has been generated into the lang/c directory of your project.
If you select a machine, you get a c file and a header file (.h) with the same name as the selected component.

![Component Code Generation Dialog](images/component-generation.jpg)

* project mode: you select your project in the workspaces view, you right-click the select "code generator". The dialog below shows up. After having selected the proper translation profile, the top-level component and possibly checked the "generate main" option, click OK.

![Project Code Generation Dialog](images/project-generation.jpg)


Several translation profiles are available:
* C9X
* Project
* Light
* 01
* PIC